f = require 'franim'
n = require 'numberer'
draw = require './draw'
Circle = require './circle'
vec = require 'vec2d'

f "canvas",
  config:
    fullSize: true

  clear: (ctx) ->
    ctx.fillStyle = "rgb(234, 244, 250)"
    ctx.fillRect 0, 0, @width.get(), @height.get()

  setup: (ctx) ->
    @width = new n @anim.getWidth
    @height = new n @anim.getHeight
    @clear(ctx)
    @circles = []
    for i in [0...30]
      @circles.push
        center:
          x: Math.random() * (@width.get() - 100) + 50
          y: Math.random() * (@height.get() - 100) + 50
        velocity:
          x: Math.random() * 8 - 4
          y: Math.random() * 8 - 4
        radius: Math.random() * 40 + 10
    # console.log JSON.stringify(@circles)
    @circles = [{"center":{"x":329.7511033108458,"y":124.8709150464274},"velocity":{"x":1.82507043518126,"y":-3.801978264003992},"radius":28.21277012117207},{"center":{"x":392.71635251212865,"y":90.38770812028088},"velocity":{"x":-3.822002800181508,"y":0.6682917233556509},"radius":41.518910275772214},{"center":{"x":308.0931386137381,"y":60.4499884492252},"velocity":{"x":-0.4663954898715019,"y":-2.966704335063696},"radius":13.530204277485609},{"center":{"x":245.43473534379154,"y":208.5911042566877},"velocity":{"x":-3.395714530721307,"y":-0.7424422111362219},"radius":27.423030454665422},{"center":{"x":107.84581227507442,"y":161.8849455700256},"velocity":{"x":-3.0804037898778915,"y":0.33379891514778137},"radius":43.45865613780916},{"center":{"x":345.40041262470186,"y":167.4233772594016},"velocity":{"x":-0.2834489308297634,"y":3.694600520655513},"radius":30.489854589104652},{"center":{"x":208.58164620492607,"y":141.58038804633543},"velocity":{"x":1.541344989091158,"y":-3.5019289925694466},"radius":41.77850438281894},{"center":{"x":454.2715580519289,"y":101.75638760905713},"velocity":{"x":-1.4080913551151752,"y":-3.4974512681365013},"radius":39.17241436429322},{"center":{"x":331.1351579679176,"y":228.95254917698912},"velocity":{"x":3.3732288517057896,"y":-0.015721770003437996},"radius":41.54814248904586},{"center":{"x":456.29514652118087,"y":59.23323312983848},"velocity":{"x":-0.8979692123830318,"y":-2.349965138360858},"radius":48.80524951033294},{"center":{"x":99.60407792124897,"y":86.80382725317031},"velocity":{"x":-0.03793899342417717,"y":2.711569832637906},"radius":16.09258098527789},{"center":{"x":236.89413266722113,"y":227.1670621598605},"velocity":{"x":3.1249668765813112,"y":-1.0579880978912115},"radius":46.12681960687041},{"center":{"x":332.78446312248707,"y":55.31457384582609},"velocity":{"x":-2.4830691181123257,"y":1.3830266762524843},"radius":23.931690650060773},{"center":{"x":190.92620459664613,"y":91.03104250272736},"velocity":{"x":1.3543665874749422,"y":2.648732813075185},"radius":34.262162344530225},{"center":{"x":362.5793596068397,"y":159.99068022845313},"velocity":{"x":1.7983210366219282,"y":-3.8954099472612143},"radius":45.012798737734556},{"center":{"x":237.50551318749785,"y":135.7461290517822},"velocity":{"x":-1.1024693604558706,"y":-1.7052645366638899},"radius":27.270837854593992},{"center":{"x":330.04331761505455,"y":113.47808893932961},"velocity":{"x":3.6706928201019764,"y":2.599521668627858},"radius":22.85113465040922},{"center":{"x":406.88711014855653,"y":173.6873872114811},"velocity":{"x":0.5160532798618078,"y":-1.8631503377109766},"radius":48.75737295486033},{"center":{"x":210.31504613999277,"y":103.73105614958331},"velocity":{"x":-2.0024834983050823,"y":-0.22137243673205376},"radius":41.32585412822664},{"center":{"x":250.68508010357618,"y":210.841607891256},"velocity":{"x":-0.9652214776724577,"y":2.3467086143791676},"radius":38.62000587396324},{"center":{"x":276.7940786294639,"y":198.60725408024155},"velocity":{"x":3.0712295584380627,"y":1.1519331373274326},"radius":39.13282563909888},{"center":{"x":346.9988042637706,"y":127.10465011117049},"velocity":{"x":-1.063142117112875,"y":-3.5548322442919016},"radius":37.76525973342359},{"center":{"x":343.57300450932235,"y":186.99264713097364},"velocity":{"x":-2.0174202863126993,"y":0.6088804118335247},"radius":12.54584675654769},{"center":{"x":105.58642429020256,"y":123.00269025401212},"velocity":{"x":2.416861604899168,"y":2.0807046964764595},"radius":21.0484170448035},{"center":{"x":133.42687871027738,"y":63.42060645017773},"velocity":{"x":1.2541372198611498,"y":3.0145662426948547},"radius":19.526246674358845},{"center":{"x":399.5216870903969,"y":211.37180193630047},"velocity":{"x":1.3469152804464102,"y":3.973563928157091},"radius":37.263121362775564},{"center":{"x":257.2064972287044,"y":232.46047832630575},"velocity":{"x":-2.1627510841935873,"y":0.5006621591746807},"radius":10.826023574918509},{"center":{"x":217.0801703631878,"y":109.30802809796296},"velocity":{"x":-3.4574277345091105,"y":-2.568949645385146},"radius":36.837164144963026},{"center":{"x":435.0869121700525,"y":100.82374892174266},"velocity":{"x":3.3907120916992426,"y":-2.522062536329031},"radius":49.11878431215882},{"center":{"x":227.10339870397002,"y":53.75067453458905},"velocity":{"x":-3.498907981440425,"y":-1.6119128540158272},"radius":35.939528215676546}] 
    @circles = @circles.map (circle)->
      new Circle circle
    return

  update: (time) ->
    for circle in @circles
      circle.edge(vec(@width.get(),@height.get()))
      circle.separate(@circles)
      circle.update(time)
  draw: (ctx) ->
    @clear(ctx)
    for circle in @circles
      circle.draw(ctx)
    # @anim.pause();
    return